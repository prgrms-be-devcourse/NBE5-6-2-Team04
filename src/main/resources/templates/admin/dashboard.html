<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DevQuest 관리자 페이지</title>
  <link rel="stylesheet" href="/css/common.css" />
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Arial', sans-serif;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
    }

    .container {
      width: 60%;
      padding: 40px 20px;
      text-align: center;
      display: flex;
      flex-direction: column;
      height: 70vh;
      box-sizing: border-box;
    }

    h1 {
      margin-bottom: 30px;
      font-size: 30px;
      font-weight: bolder;
    }

    .tabs {
      margin-bottom: 20px;
      display: flex;
      justify-content: flex-end;
      gap: 24px;
    }

    .tab-btn {
      padding: 8px 0;
      font-size: 16px;
      font-weight: 600;
      color: #555;
      cursor: pointer;
      text-decoration: none;
      border-bottom: 2px solid transparent; /* 기본 투명 밑줄 */
      transition: color 0.3s, border-color 0.3s;
    }

    .tab-btn:hover {
      color: #3b4bd3;
      border-bottom-color: #3b4bd3;
    }

    .tab-btn.active {
      color: #3b4bd3;
      border-bottom-color: #3b4bd3;
      font-weight: bold;
    }

    .member-title {
      font-size: 22px;
      margin-bottom: 10px;
    }

    table.member-table {
      width: 100%;
      border-collapse: collapse;
      table-layout: fixed; /* 열 너비 고정 */
    }

    .member-table th,
    .member-table td {
      padding: 14px 12px;
      text-align: center;
      font-size: 15px;
      border-bottom: 1px solid #ddd;
      word-wrap: break-word;
      overflow-wrap: break-word;
    }

    .email-small {
      font-size: 13px;
      color: #666;
      display: block;
      margin-top: 4px;
    }

    .role-admin {
      color: #1a73e8;
    }

    button {
      padding: 6px 12px;
      border-radius: 6px;
      border: none;
      background-color: #d9534f;
      color: white;
      cursor: pointer;
    }

    .table-scroll-area {
      flex-grow: 1;
      overflow-y: auto;
      border-top: 1px solid #ddd;
      border-bottom: 1px solid #ddd;
      max-height: 400px;
      margin-top: -1px;
    }
  </style>
</head>
<body>
<div id="logo-container"></div>

<div class="container">
  <h1>관리자님 안녕하세요</h1>

  <h3 class="member-title">회원 목록</h3>

  <div class="tabs">
    <a href="#" class="tab-btn" onclick="showTab('admin-users'); return false;">관리자</a>
    <a href="#" class="tab-btn active" onclick="showTab('active-users'); return false;">현재 회원</a>
    <a href="#" class="tab-btn" onclick="showTab('deleted-users'); return false;">탈퇴 회원</a>
  </div>


  <hr />

  <div class="table-scroll-area">
    <table class="member-table">
      <thead>
      <tr>
        <th style="width: 15%;">번호</th>
        <th style="width: 30%;">사용자</th>
        <th style="width: 20%;">가입일</th>
        <th style="width: 15%;">권한</th>
        <th style="width: 20%;">관리</th>
      </tr>
      </thead>
      <!-- 관리자 -->
      <tbody id="admin-users" style="display:none;">
      <tr th:each="user, iterStat : ${adminUsers}">
        <td th:text="${iterStat.count}">1</td>
        <td>
          <div th:text="${user.nickname}">닉네임</div>
          <span class="email-small" th:text="${user.email}">user@example.com</span>
        </td>
        <td th:text="${user.createdAt}">2025-05-15</td>
        <td>
          <span class="role-admin">관리자</span>
        </td>
        <td>
          <form th:action="@{/admin/removeUser}" method="post">
            <input type="hidden" name="email" th:value="${user.email}" />
            <button type="submit" onclick="return confirm('정말 삭제하시겠습니까?');">삭제</button>
          </form>
        </td>
      </tr>
      </tbody>

      <!-- 현재 회원 -->
      <tbody id="active-users">
      <tr th:each="user, iterStat : ${activeUsers}">
        <td th:text="${iterStat.count}">1</td>
        <td>
          <div th:text="${user.nickname}">닉네임</div>
          <span class="email-small" th:text="${user.email}">user@example.com</span>
        </td>
        <td th:text="${user.createdAt}">2025-05-15</td>
        <td>
          <span th:if="${user.role.name() == 'ROLE_ADMIN'}" class="role-admin">관리자</span>
          <span th:unless="${user.role.name() == 'ROLE_ADMIN'}"></span>
        </td>
        <td>
          <form th:action="@{/admin/removeUser}" method="post">
            <input type="hidden" name="email" th:value="${user.email}" />
            <button type="submit" onclick="return confirm('정말 삭제하시겠습니까?');">삭제</button>
          </form>
        </td>
      </tr>
      </tbody>

      <!-- 탈퇴 회원 -->
      <tbody id="deleted-users" style="display:none;">
      <tr th:each="user, iterStat : ${deletedUsers}">
        <td th:text="${iterStat.count}">1</td>
        <td>
          <div th:text="${user.nickname}">닉네임</div>
          <span class="email-small" th:text="${user.email}">user@example.com</span>
        </td>
        <td th:text="${user.createdAt}">2025-05-15</td>
        <td>
          <span th:if="${user.role.name() == 'ROLE_ADMIN'}" class="role-admin">관리자</span>
          <span th:unless="${user.role.name() == 'ROLE_ADMIN'}"></span>
        </td>
        <td>
          <span style="color: #888;">탈퇴</span><br />
          <span class="email-small" th:text="${#temporals.format(user.deletedAt, 'yyyy-MM-dd')}"></span>
        </td>
      </tr>
      </tbody>
    </table>
  </div>
</div>

<script>
  fetch('/css/logo.html')
  .then((res) => res.text())
  .then((html) => {
    document.getElementById('logo-container').innerHTML = html;
  });

  function showTab(tabId) {
    document.getElementById('active-users').style.display = tabId === 'active-users' ? '' : 'none';
    document.getElementById('deleted-users').style.display = tabId === 'deleted-users' ? '' : 'none';
    document.getElementById('admin-users').style.display = tabId === 'admin-users' ? '' : 'none';  // 추가

    document.querySelectorAll('.tab-btn').forEach((btn) => btn.classList.remove('active'));
    const activeBtn = document.querySelector(`.tab-btn[onclick*="${tabId}"]`);
    if (activeBtn) activeBtn.classList.add('active');
  }

</script>
</body>
</html>
